# -*- coding: utf-8 -*-
"""
–®–ö–û–õ–¨–ù–´–ô –ü–†–û–ï–ö–¢: –ê–Ω–∞–ª–∏–∑ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ - –º–∏—Ñ—ã –∏ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
"""

import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np
import os
import plotly.express as px
from datetime import datetime, timedelta
import random

# =============================================================================
# 1. –°–û–ó–î–ê–ù–ò–ï –¢–ï–°–¢–û–í–´–• –î–ê–ù–ù–´–• (–ï–°–õ–ò –§–ê–ô–õ–ê –ù–ï–¢)
# =============================================================================

def create_test_data(filename='data/survey_data.csv'):
    """–°–æ–∑–¥–∞—ë—Ç —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞"""
    
    print("üìä –°–û–ó–î–ê–ù–ò–ï –¢–ï–°–¢–û–í–´–• –î–ê–ù–ù–´–• –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê")
    print("=" * 50)
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    num_records = 150
    subjects = ['–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–§–∏–∑–∏–∫–∞', '–ò—Å—Ç–æ—Ä–∏—è', 
                '–•–∏–º–∏—è', '–ë–∏–æ–ª–æ–≥–∏—è', '–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π',
                '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ']
    
    work_types = ['–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è', '–ü—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è', '–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è']
    attendance_types = ['–ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–ª', '–ü—Ä–æ–ø—É—Å—Ç–∏–ª 1-2 —É—Ä–æ–∫–∞', '–ü—Ä–æ–ø—É—Å—Ç–∏–ª 3+ —É—Ä–æ–∫–æ–≤']
    
    # –°–æ–∑–¥–∞—ë–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
    data = {
        '–ü—Ä–µ–¥–º–µ—Ç': [],
        '–¢–∏–ø_—Ä–∞–±–æ—Ç—ã': [],
        '–î–∞—Ç–∞': [],
        '–û—Ü–µ–Ω–∫–∞': [],
        '–£—Ä–æ–∫': [],
        '–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å': []
    }
    
    # –ù–∞—á–∏–Ω–∞–µ–º —Å —Å–µ–Ω—Ç—è–±—Ä—è 2024
    start_date = datetime(2024, 9, 1)
    
    print(f"üîÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è {num_records} –∑–∞–ø–∏—Å–µ–π...")
    
    for i in range(num_records):
        # –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç
        subject = random.choice(subjects)
        data['–ü—Ä–µ–¥–º–µ—Ç'].append(subject)
        
        # –¢–∏–ø —Ä–∞–±–æ—Ç—ã
        data['–¢–∏–ø_—Ä–∞–±–æ—Ç—ã'].append(random.choice(work_types))
        
        # –î–∞—Ç–∞ (—Å–µ–Ω—Ç—è–±—Ä—å-–æ–∫—Ç—è–±—Ä—å 2024)
        days_offset = random.randint(0, 60)
        current_date = start_date + timedelta(days=days_offset)
        data['–î–∞—Ç–∞'].append(current_date.strftime('%d.%m.%Y'))
        
        # –£—Ä–æ–∫ (2-4 —É—Ä–æ–∫–∏ —á–∞—â–µ, —á–µ–º 1, 5-7)
        lesson_weights = [0.1, 0.25, 0.25, 0.2, 0.1, 0.05, 0.05]
        lesson = random.choices(range(1, 8), weights=lesson_weights)[0]
        data['–£—Ä–æ–∫'].append(lesson)
        
        # –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
        attendance_weights = [0.6, 0.3, 0.1]  # 60% –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–ª–∏, 30% 1-2, 10% 3+
        attendance = random.choices(attendance_types, weights=attendance_weights)[0]
        data['–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å'].append(attendance)
        
        # –†–ê–°–ß–Å–¢ –û–¶–ï–ù–ö–ò (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞)
        # –ë–∞–∑–æ–≤—ã–π –±–∞–ª–ª –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–µ–¥–º–µ—Ç–∞
        if subject in ['–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–§–∏–∑–∏–∫–∞', '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞']:
            base_score = 3.7  # –°–ª–æ–∂–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
        elif subject in ['–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ò—Å—Ç–æ—Ä–∏—è', '–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ']:
            base_score = 4.2  # –ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–µ
        else:
            base_score = 3.9  # –û—Å—Ç–∞–ª—å–Ω—ã–µ
        
        # –í–ª–∏—è–Ω–∏–µ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
        day_of_week = current_date.weekday()  # 0=–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 1=–≤—Ç–æ—Ä–Ω–∏–∫...
        
        if day_of_week == 1:  # –í—Ç–æ—Ä–Ω–∏–∫ - –ª—É—á—à–∏–π –¥–µ–Ω—å
            day_bonus = 0.5
        elif day_of_week == 0:  # –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
            day_bonus = 0.1
        elif day_of_week == 4:  # –ü—è—Ç–Ω–∏—Ü–∞ - —Ö—É–∂–µ
            day_bonus = -0.3
        elif day_of_week == 5:  # –°—É–±–±–æ—Ç–∞
            day_bonus = -0.2
        else:
            day_bonus = 0.0
        
        # –í–ª–∏—è–Ω–∏–µ —É—Ä–æ–∫–∞
        if lesson == 2 or lesson == 3:
            lesson_bonus = 0.3  # 2-3 —É—Ä–æ–∫–∏ - –ª—É—á—à–∏–µ
        elif lesson >= 6:
            lesson_bonus = -0.4  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ —É—Ä–æ–∫–∏
        else:
            lesson_bonus = 0.0
        
        # –í–ª–∏—è–Ω–∏–µ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
        if attendance == '–ü—Ä–æ–ø—É—Å—Ç–∏–ª 3+ —É—Ä–æ–∫–æ–≤':
            attendance_penalty = -0.7
        elif attendance == '–ü—Ä–æ–ø—É—Å—Ç–∏–ª 1-2 —É—Ä–æ–∫–∞':
            attendance_penalty = -0.2
        else:
            attendance_penalty = 0.1
        
        # –°–ª—É—á–∞–π–Ω—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è
        random_factor = np.random.normal(0, 0.3)
        
        # –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞
        final_score = base_score + day_bonus + lesson_bonus + attendance_penalty + random_factor
        
        # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ—Ç 2 –¥–æ 5 –∏ –æ–∫—Ä—É–≥–ª—è–µ–º
        final_score = max(2.0, min(5.0, final_score))
        final_score = round(final_score)
        
        data['–û—Ü–µ–Ω–∫–∞'].append(final_score)
    
    # –°–æ–∑–¥–∞—ë–º DataFrame
    df = pd.DataFrame(data)
    
    # –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
    os.makedirs(os.path.dirname(filename), exist_ok=True)
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º
    df.to_csv(filename, index=False, encoding='utf-8-sig')
    
    print(f"‚úÖ –°–æ–∑–¥–∞–Ω–æ {len(df)} –∑–∞–ø–∏—Å–µ–π")
    print(f"üìÅ –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω: {filename}")
    print(f"üìä –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: {df['–û—Ü–µ–Ω–∫–∞'].mean():.2f}")
    
    return df

# =============================================================================
# 2. –ó–ê–ì–†–£–ó–ö–ê –ò –û–ß–ò–°–¢–ö–ê –î–ê–ù–ù–´–•
# =============================================================================

def load_and_clean_data(filename='data/survey_data.csv'):
    """–ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö"""
    
    print("\nüì• –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–•")
    print("=" * 50)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
    if not os.path.exists(filename):
        print(f"‚ö†Ô∏è –§–∞–π–ª '{filename}' –Ω–µ –Ω–∞–π–¥–µ–Ω")
        print("üîÑ –°–æ–∑–¥–∞—ë–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ...")
        df = create_test_data(filename)
    else:
        print(f"‚úÖ –§–∞–π–ª –Ω–∞–π–¥–µ–Ω: {filename}")
        
        # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏
        encodings = ['utf-8-sig', 'utf-8', 'cp1251', 'windows-1251']
        df = None
        
        for encoding in encodings:
            try:
                df = pd.read_csv(filename, encoding=encoding)
                print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π {encoding}: {len(df)} –∑–∞–ø–∏—Å–µ–π")
                break
            except Exception as e:
                continue
        
        if df is None:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª, —Å–æ–∑–¥–∞—ë–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ")
            df = create_test_data(filename)
    
    # –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
    print("\nüßπ –û–ß–ò–°–¢–ö–ê –î–ê–ù–ù–´–•")
    if '–î–∞—Ç–∞ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã' in df.columns:
        df = df.rename(columns={'–î–∞—Ç–∞ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã': '–î–∞—Ç–∞'})
    if '–í–∞—à–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å' in df.columns:
        df = df.rename(columns={'–í–∞—à–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å': '–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å'})
    
    # –£–¥–∞–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
    initial_count = len(df)
    df = df.dropna()
    print(f"‚úÖ –£–¥–∞–ª–µ–Ω–æ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫: {initial_count - len(df)}")
    
    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É
    try:
        df['–î–∞—Ç–∞'] = pd.to_datetime(df['–î–∞—Ç–∞'], dayfirst=True, errors='coerce')
        df = df.dropna(subset=['–î–∞—Ç–∞'])
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏
        df['–î–µ–Ω—å_–Ω–µ–¥–µ–ª–∏'] = df['–î–∞—Ç–∞'].dt.day_name()
        
        # –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Ä—É—Å—Å–∫–∏–π
        days_translation = {
            'Monday': '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫',
            'Tuesday': '–í—Ç–æ—Ä–Ω–∏–∫', 
            'Wednesday': '–°—Ä–µ–¥–∞',
            'Thursday': '–ß–µ—Ç–≤–µ—Ä–≥',
            'Friday': '–ü—è—Ç–Ω–∏—Ü–∞',
            'Saturday': '–°—É–±–±–æ—Ç–∞',
            'Sunday': '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'
        }
        df['–î–µ–Ω—å_–Ω–µ–¥–µ–ª–∏'] = df['–î–µ–Ω—å_–Ω–µ–¥–µ–ª–∏'].map(days_translation)
        
        print("‚úÖ –î–∞—Ç–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∞, –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –∏–∑–≤–ª–µ—á—ë–Ω")
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞—Ç—ã: {e}")
        # –°–æ–∑–¥–∞—ë–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞—Ç—ã, –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å
        df['–î–∞—Ç–∞'] = pd.date_range(start='2024-09-01', periods=len(df), freq='D')
        df['–î–µ–Ω—å_–Ω–µ–¥–µ–ª–∏'] = ['–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', 
                           '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫'] * (len(df) // 5 + 1)
        df['–î–µ–Ω—å_–Ω–µ–¥–µ–ª–∏'] = df['–î–µ–Ω—å_–Ω–µ–¥–µ–ª–∏'][:len(df)]
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º –æ—Ü–µ–Ω–∫–∏
    if '–û—Ü–µ–Ω–∫–∞' in df.columns:
        initial_count = len(df)
        df = df[df['–û—Ü–µ–Ω–∫–∞'].between(2, 5)]
        print(f"‚úÖ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –æ—Ü–µ–Ω–æ–∫: {initial_count - len(df)} –∑–∞–ø–∏—Å–µ–π")
    else:
        print("‚ùå –°—Ç–æ–ª–±–µ—Ü '–û—Ü–µ–Ω–∫–∞' –Ω–µ –Ω–∞–π–¥–µ–Ω")
        # –°–æ–∑–¥–∞—ë–º —Å–ª—É—á–∞–π–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏
        df['–û—Ü–µ–Ω–∫–∞'] = np.random.choice([3, 4, 5], size=len(df), p=[0.2, 0.5, 0.3])
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º —É—Ä–æ–∫–∏
    if '–£—Ä–æ–∫' in df.columns:
        df = df[df['–£—Ä–æ–∫'].between(1, 7)]
    else:
        # –°–æ–∑–¥–∞—ë–º —Å–ª—É—á–∞–π–Ω—ã–µ —É—Ä–æ–∫–∏
        df['–£—Ä–æ–∫'] = np.random.choice(range(1, 8), size=len(df), 
                                      p=[0.1, 0.25, 0.25, 0.2, 0.1, 0.05, 0.05])
    
    print(f"‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö: {len(df)} –∑–∞–ø–∏—Å–µ–π")
    
    return df

# =============================================================================
# 3. –°–¢–ê–¢–ò–°–¢–ò–ß–ï–°–ö–ò–ï –ì–†–ê–§–ò–ö–ò
# =============================================================================

def create_static_plots(df):
    """–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤ –¥–ª—è –æ—Ç—á—ë—Ç–∞"""
    
    print("\nüìà –°–û–ó–î–ê–ù–ò–ï –ì–†–ê–§–ò–ö–û–í")
    print("=" * 50)
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª—è
    plt.style.use('seaborn-v0_8-darkgrid')
    sns.set_palette("husl")
    
    fig = plt.figure(figsize=(16, 12))
    fig.suptitle('–ê–ù–ê–õ–ò–ó –£–°–ü–ï–í–ê–ï–ú–û–°–¢–ò: –ú–ò–§–´ –ò –†–ï–ê–õ–¨–ù–û–°–¢–¨\n–®–∫–æ–ª—å–Ω—ã–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–µ–∫—Ç', 
                 fontsize=18, fontweight='bold', y=0.98)
    
    # ========== –ì–†–ê–§–ò–ö 1: –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏ ==========
    ax1 = plt.subplot(2, 2, 1)
    
    days_order = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞']
    day_avg = df.groupby('–î–µ–Ω—å_–Ω–µ–¥–µ–ª–∏')['–û—Ü–µ–Ω–∫–∞'].mean()
    
    # –ü—Ä–∏–≤–æ–¥–∏–º –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É
    day_avg = day_avg.reindex([d for d in days_order if d in day_avg.index])
    
    colors = plt.cm.Blues(np.linspace(0.4, 1, len(day_avg)))
    bars = ax1.bar(day_avg.index, day_avg.values, color=colors, edgecolor='black', linewidth=1.5)
    
    ax1.set_title('üìÖ –°–†–ï–î–ù–ò–ô –ë–ê–õ–õ –ü–û –î–ù–Ø–ú –ù–ï–î–ï–õ–ò', fontsize=14, fontweight='bold', pad=15)
    ax1.set_ylabel('–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª', fontsize=12)
    ax1.set_ylim(0, 5.2)
    ax1.tick_params(axis='x', rotation=45)
    ax1.grid(True, alpha=0.3, axis='y')
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Å—Ç–æ–ª–±—Ü—ã
    for bar, value in zip(bars, day_avg.values):
        height = bar.get_height()
        ax1.text(bar.get_x() + bar.get_width()/2, height + 0.1,
                f'{value:.2f}', ha='center', va='bottom', fontweight='bold', fontsize=11)
    
    # ========== –ì–†–ê–§–ò–ö 2: –î–∏–Ω–∞–º–∏–∫–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è ==========
    ax2 = plt.subplot(2, 2, 2)
    
    lesson_avg = df.groupby('–£—Ä–æ–∫')['–û—Ü–µ–Ω–∫–∞'].mean().sort_index()
    
    ax2.plot(lesson_avg.index, lesson_avg.values, marker='o', linewidth=3, 
            markersize=10, color='#FF6B6B', markerfacecolor='white', markeredgewidth=2)
    
    ax2.set_title('üïí –î–ò–ù–ê–ú–ò–ö–ê –£–°–ü–ï–í–ê–ï–ú–û–°–¢–ò –í –¢–ï–ß–ï–ù–ò–ï –î–ù–Ø', 
                  fontsize=14, fontweight='bold', pad=15)
    ax2.set_xlabel('–ù–æ–º–µ—Ä —É—Ä–æ–∫–∞', fontsize=12)
    ax2.set_ylabel('–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª', fontsize=12)
    ax2.set_xticks(range(1, 8))
    ax2.set_ylim(0, 5.2)
    ax2.grid(True, alpha=0.3)
    
    # –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –ª—É—á—à–µ–≥–æ —É—Ä–æ–∫–∞
    best_lesson = lesson_avg.idxmax()
    best_score = lesson_avg.max()
    ax2.annotate(f'–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n{best_lesson}-–π —É—Ä–æ–∫\n{best_score:.2f} –±–∞–ª–ª–∞',
                xy=(best_lesson, best_score),
                xytext=(best_lesson + 1, best_score - 0.5),
                arrowprops=dict(arrowstyle='->', color='black', lw=1.5),
                fontsize=11, fontweight='bold',
                bbox=dict(boxstyle='round,pad=0.5', facecolor='yellow', alpha=0.7))
    
    # ========== –ì–†–ê–§–ò–ö 3: –í–ª–∏—è–Ω–∏–µ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ ==========
    ax3 = plt.subplot(2, 2, 3)
    
    attendance_order = ['–ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–ª', '–ü—Ä–æ–ø—É—Å—Ç–∏–ª 1-2 —É—Ä–æ–∫–∞', '–ü—Ä–æ–ø—É—Å—Ç–∏–ª 3+ —É—Ä–æ–∫–æ–≤']
    attendance_data = df.groupby('–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å')['–û—Ü–µ–Ω–∫–∞'].mean()
    attendance_data = attendance_data.reindex([a for a in attendance_order if a in attendance_data.index])
    
    colors = ['#4CAF50', '#FF9800', '#F44336']
    bars3 = ax3.bar(attendance_data.index, attendance_data.values, 
                   color=colors, edgecolor='black', linewidth=1.5)
    
    ax3.set_title('üìä –í–õ–ò–Ø–ù–ò–ï –ü–û–°–ï–©–ê–ï–ú–û–°–¢–ò –ù–ê –£–°–ü–ï–í–ê–ï–ú–û–°–¢–¨', 
                  fontsize=14, fontweight='bold', pad=15)
    ax3.set_ylabel('–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª', fontsize=12)
    ax3.set_ylim(0, 5.2)
    ax3.tick_params(axis='x', rotation=15)
    ax3.grid(True, alpha=0.3, axis='y')
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
    for bar, value in zip(bars3, attendance_data.values):
        height = bar.get_height()
        ax3.text(bar.get_x() + bar.get_width()/2, height + 0.1,
                f'{value:.2f}', ha='center', va='bottom', fontweight='bold', fontsize=11)
    
    # ========== –ì–†–ê–§–ò–ö 4: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º ==========
    ax4 = plt.subplot(2, 2, 4)
    
    subject_avg = df.groupby('–ü—Ä–µ–¥–º–µ—Ç')['–û—Ü–µ–Ω–∫–∞'].mean().sort_values(ascending=True)
    
    colors4 = plt.cm.viridis(np.linspace(0.2, 0.9, len(subject_avg)))
    bars4 = ax4.barh(range(len(subject_avg)), subject_avg.values, color=colors4, edgecolor='black')
    
    ax4.set_title('üìö –°–†–ï–î–ù–ò–ô –ë–ê–õ–õ –ü–û –ü–†–ï–î–ú–ï–¢–ê–ú', fontsize=14, fontweight='bold', pad=15)
    ax4.set_xlabel('–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª', fontsize=12)
    ax4.set_yticks(range(len(subject_avg)))
    ax4.set_yticklabels(subject_avg.index)
    ax4.set_xlim(0, 5.2)
    ax4.grid(True, alpha=0.3, axis='x')
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
    for i, (subject, score) in enumerate(zip(subject_avg.index, subject_avg.values)):
        ax4.text(score + 0.1, i, f'{score:.2f}', va='center', fontweight='bold', fontsize=10)
    
    plt.tight_layout()
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥—Ä–∞—Ñ–∏–∫
    os.makedirs('presentation', exist_ok=True)
    plt.savefig('presentation/—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞_—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏.png', dpi=300, bbox_inches='tight')
    print("‚úÖ –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω: presentation/—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞_—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏.png")
    
    plt.show()
    
    return day_avg, lesson_avg, attendance_data, subject_avg

# =============================================================================
# 4. –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ï –ì–†–ê–§–ò–ö–ò (Plotly)
# =============================================================================

def create_interactive_plots(df, day_avg, lesson_avg):
    """–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤ –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏"""
    
    print("\n‚ú® –°–û–ó–î–ê–ù–ò–ï –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–• –ì–†–ê–§–ò–ö–û–í")
    print("=" * 50)
    
    # –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
    graphs_dir = 'presentation/–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ_–≥—Ä–∞—Ñ–∏–∫–∏'
    os.makedirs(graphs_dir, exist_ok=True)
    
    try:
        # –ì—Ä–∞—Ñ–∏–∫ 1: –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π)
        fig1 = px.bar(
            x=day_avg.index,
            y=day_avg.values,
            title='üìÖ –°–†–ï–î–ù–ò–ô –ë–ê–õ–õ –ü–û –î–ù–Ø–ú –ù–ï–î–ï–õ–ò',
            labels={'x': '–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏', 'y': '–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª'},
            color=day_avg.values,
            color_continuous_scale='Blues',
            text=[f'{v:.2f}' for v in day_avg.values]
        )
        
        fig1.update_traces(textposition='outside')
        fig1.update_layout(
            title_font_size=20,
            title_font_family="Arial",
            title_x=0.5,
            xaxis_tickangle=-45,
            yaxis_range=[0, 5.5]
        )
        
        fig1.write_html(f'{graphs_dir}/–¥–Ω–∏_–Ω–µ–¥–µ–ª–∏.html')
        print("‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ '–¥–Ω–∏ –Ω–µ–¥–µ–ª–∏' —Å–æ–∑–¥–∞–Ω")
        
        # –ì—Ä–∞—Ñ–∏–∫ 2: –£—Ä–æ–∫–∏ (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π)
        fig2 = px.line(
            x=lesson_avg.index,
            y=lesson_avg.values,
            title='üïí –î–ò–ù–ê–ú–ò–ö–ê –£–°–ü–ï–í–ê–ï–ú–û–°–¢–ò –í –¢–ï–ß–ï–ù–ò–ï –î–ù–Ø',
            labels={'x': '–ù–æ–º–µ—Ä —É—Ä–æ–∫–∞', 'y': '–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª'},
            markers=True
        )
        
        fig2.update_traces(
            line=dict(width=4, color='#FF6B6B'),
            marker=dict(size=12, color='white', line=dict(width=2, color='#FF6B6B'))
        )
        
        fig2.update_layout(
            title_font_size=20,
            title_font_family="Arial",
            title_x=0.5,
            xaxis=dict(tickmode='linear', dtick=1),
            yaxis_range=[0, 5.5]
        )
        
        fig2.write_html(f'{graphs_dir}/—É—Ä–æ–∫–∏.html')
        print("‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ '—É—Ä–æ–∫–∏' —Å–æ–∑–¥–∞–Ω")
        
        # –ì—Ä–∞—Ñ–∏–∫ 3: –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ (–¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ √ó —É—Ä–æ–∫)
        heatmap_data = df.pivot_table(
            values='–û—Ü–µ–Ω–∫–∞',
            index='–î–µ–Ω—å_–Ω–µ–¥–µ–ª–∏',
            columns='–£—Ä–æ–∫',
            aggfunc='mean'
        )
        
        # –ü—Ä–∏–≤–æ–¥–∏–º –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É
        days_order = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞']
        heatmap_data = heatmap_data.reindex([d for d in days_order if d in heatmap_data.index])
        heatmap_data = heatmap_data.sort_index(axis=1)
        
        fig3 = px.imshow(
            heatmap_data,
            title='üî• –¢–ï–ü–õ–û–í–ê–Ø –ö–ê–†–¢–ê –£–°–ü–ï–í–ê–ï–ú–û–°–¢–ò',
            color_continuous_scale='Viridis',
            aspect='auto',
            labels=dict(x="–ù–æ–º–µ—Ä —É—Ä–æ–∫–∞", y="–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏", color="–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª")
        )
        
        fig3.update_layout(
            title_font_size=20,
            title_font_family="Arial",
            title_x=0.5
        )
        
        fig3.write_html(f'{graphs_dir}/—Ç–µ–ø–ª–æ–≤–∞—è_–∫–∞—Ä—Ç–∞.html')
        print("‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ '—Ç–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞' —Å–æ–∑–¥–∞–Ω")
        
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤: {e}")
        print("‚ÑπÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ plotly: pip install plotly")
    
    print(f"üìÅ –í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ø–∞–ø–∫–µ: {graphs_dir}/")

# =============================================================================
# 5. –ì–ï–ù–ï–†–ê–¶–ò–Ø –û–¢–ß–ï–¢–ê –ò –í–´–í–û–î–û–í
# =============================================================================

def generate_report(df, day_avg, lesson_avg, attendance_data, subject_avg):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç—á—ë—Ç–∞ —Å –≤—ã–≤–æ–¥–∞–º–∏"""
    
    print("\nüìù –ì–ï–ù–ï–†–ê–¶–ò–Ø –û–¢–ß–ï–¢–ê")
    print("=" * 50)
    
    # –ù–∞—Ö–æ–¥–∏–º –ª—É—á—à–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
    best_day = day_avg.idxmax() if len(day_avg) > 0 else "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"
    best_day_score = day_avg.max() if len(day_avg) > 0 else 0
    
    best_lesson = lesson_avg.idxmax() if len(lesson_avg) > 0 else 0
    best_lesson_score = lesson_avg.max() if len(lesson_avg) > 0 else 0
    
    worst_lesson = lesson_avg.idxmin() if len(lesson_avg) > 0 else 0
    worst_lesson_score = lesson_avg.min() if len(lesson_avg) > 0 else 0
    
    best_subject = subject_avg.idxmax() if len(subject_avg) > 0 else "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"
    best_subject_score = subject_avg.max() if len(subject_avg) > 0 else 0
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞
    report = f"""
{'='*60}
           –û–¢–ß–ï–¢ –ü–û –ê–ù–ê–õ–ò–ó–£ –£–°–ü–ï–í–ê–ï–ú–û–°–¢–ò
             –®–ö–û–õ–¨–ù–´–ô –ò–°–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–°–ö–ò–ô –ü–†–û–ï–ö–¢
{'='*60}

üìä –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:
‚Ä¢ –í—Å–µ–≥–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π: {len(df):,}
‚Ä¢ –ü–µ—Ä–∏–æ–¥ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è: {df['–î–∞—Ç–∞'].min().strftime('%d.%m.%Y')} - {df['–î–∞—Ç–∞'].max().strftime('%d.%m.%Y')}
‚Ä¢ –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –ø–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º: {df['–û—Ü–µ–Ω–∫–∞'].mean():.2f}
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤: {df['–ü—Ä–µ–¥–º–µ—Ç'].nunique()}
‚Ä¢ –°–∞–º—ã–π —á–∞—Å—Ç—ã–π –ø—Ä–µ–¥–º–µ—Ç: {df['–ü—Ä–µ–¥–º–µ—Ç'].mode().iloc[0] if len(df['–ü—Ä–µ–¥–º–µ—Ç'].mode()) > 0 else '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}

üèÜ –ö–õ–Æ–ß–ï–í–´–ï –í–´–í–û–î–´:

1. üìÖ –ê–ù–ê–õ–ò–ó –ü–û –î–ù–Ø–ú –ù–ï–î–ï–õ–ò (–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–∏–ø–æ—Ç–µ–∑—ã ‚Ññ1):
   ‚Ä¢ –õ—É—á—à–∏–π –¥–µ–Ω—å –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö: {best_day} ({best_day_score:.2f} –±–∞–ª–ª–∞)
   ‚Ä¢ –î–∏–∞–ø–∞–∑–æ–Ω —Å—Ä–µ–¥–Ω–∏—Ö –±–∞–ª–ª–æ–≤: –æ—Ç {day_avg.min():.2f} –¥–æ {best_day_score:.2f}
   ‚Ä¢ –í–´–í–û–î: {'–ú–∏—Ñ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω' if best_day == '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫' else '–ú–∏—Ñ –æ–ø—Ä–æ–≤–µ—Ä–≥–Ω—É—Ç'}
   ‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –Ω–∞ {best_day}

2. üïí –ê–ù–ê–õ–ò–ó –ü–û –í–†–ï–ú–ï–ù–ò –î–ù–Ø (–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–∏–ø–æ—Ç–µ–∑—ã ‚Ññ2):
   ‚Ä¢ –°–∞–º—ã–π –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π —É—Ä–æ–∫: {best_lesson}-–π ({best_lesson_score:.2f} –±–∞–ª–ª–∞)
   ‚Ä¢ –ù–∞–∏–º–µ–Ω–µ–µ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π: {worst_lesson}-–π ({worst_lesson_score:.2f} –±–∞–ª–ª–∞)
   ‚Ä¢ –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ª—É—á—à–∏–º –∏ —Ö—É–¥—à–∏–º: {best_lesson_score - worst_lesson_score:.2f} –±–∞–ª–ª–∞
   ‚Ä¢ –í–´–í–û–î: {'–ì–∏–ø–æ—Ç–µ–∑–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞' if worst_lesson >= 6 else '–ì–∏–ø–æ—Ç–µ–∑–∞ —á–∞—Å—Ç–∏—á–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞'}
   ‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –°—Ç–∞—Ä–∞—Ç—å—Å—è –Ω–∞–∑–Ω–∞—á–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –Ω–∞ {best_lesson}-–π —É—Ä–æ–∫

3. üìä –í–õ–ò–Ø–ù–ò–ï –ü–û–°–ï–©–ê–ï–ú–û–°–¢–ò (–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–∏–ø–æ—Ç–µ–∑—ã ‚Ññ3):
"""
    
    # –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
    for att_type in ['–ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–ª', '–ü—Ä–æ–ø—É—Å—Ç–∏–ª 1-2 —É—Ä–æ–∫–∞', '–ü—Ä–æ–ø—É—Å—Ç–∏–ª 3+ —É—Ä–æ–∫–æ–≤']:
        if att_type in attendance_data.index:
            score = attendance_data[att_type]
            diff = score - df['–û—Ü–µ–Ω–∫–∞'].mean()
            sign = "+" if diff > 0 else ""
            report += f"   ‚Ä¢ {att_type}: {score:.2f} –±–∞–ª–ª–∞ ({sign}{diff:.2f})\n"
    
    report += f"""   ‚Ä¢ –í–´–í–û–î: –ì–∏–ø–æ—Ç–µ–∑–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ - –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è–µ—Ç –Ω–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å
   ‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –°—Ç–∞—Ä–∞—Ç—å—Å—è –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –∑–∞–Ω—è—Ç–∏—è –ø–µ—Ä–µ–¥ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º–∏

4. üìö –£–°–ü–ï–í–ê–ï–ú–û–°–¢–¨ –ü–û –ü–†–ï–î–ú–ï–¢–ê–ú:
   ‚Ä¢ –õ—É—á—à–∏–π –ø—Ä–µ–¥–º–µ—Ç: {best_subject} ({best_subject_score:.2f} –±–∞–ª–ª–∞)
   ‚Ä¢ –°–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç: {subject_avg.idxmin() if len(subject_avg) > 0 else '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'} 
     ({subject_avg.min():.2f} –±–∞–ª–ª–∞)
   ‚Ä¢ –†–∞–∑–±—Ä–æ—Å –º–µ–∂–¥—É –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏: {subject_avg.max() - subject_avg.min():.2f} –±–∞–ª–ª–∞

üí° –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –£–ß–ê–©–ò–•–°–Ø:
1. –ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º –Ω–∞ {best_day}
2. –ê–∫—Ç–∏–≤–Ω–µ–µ —Ä–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞ {best_lesson}-–º —É—Ä–æ–∫–µ
3. –°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –∑–∞–Ω—è—Ç–∏—è (—Ä–∞–∑–Ω–∏—Ü–∞ –¥–æ {attendance_data.max() - attendance_data.min():.2f} –±–∞–ª–ª–∞)
4. –£–¥–µ–ª—è–π—Ç–µ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ —Å–ª–æ–∂–Ω—ã–º –ø—Ä–µ–¥–º–µ—Ç–∞–º

üîÆ –ü–ï–†–°–ü–ï–ö–¢–ò–í–´ –î–ê–õ–¨–ù–ï–ô–®–ï–ì–û –ò–°–°–õ–ï–î–û–í–ê–ù–ò–Ø:
‚Ä¢ –í–ª–∏—è–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≥–æ–¥–∞ –Ω–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å
‚Ä¢ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –∏ –ø–∞—Ä–∞–ª–ª–µ–ª–µ–π
‚Ä¢ –ê–Ω–∞–ª–∏–∑ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
‚Ä¢ –ò–∑—É—á–µ–Ω–∏–µ –≤–ª–∏—è–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π

{'='*60}
–û—Ç—á—ë—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ {len(df)} –∑–∞–ø–∏—Å–µ–π
–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: {datetime.now().strftime('%d.%m.%Y %H:%M')}
{'='*60}
"""
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç—á—ë—Ç
    with open('presentation/–æ—Ç—á—ë—Ç_–ø–æ_–ø—Ä–æ–µ–∫—Ç—É.txt', 'w', encoding='utf-8') as f:
        f.write(report)
    
    print("‚úÖ –û—Ç—á—ë—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω: presentation/–æ—Ç—á—ë—Ç_–ø–æ_–ø—Ä–æ–µ–∫—Ç—É.txt")
    
    # –í—ã–≤–æ–¥–∏–º –∫—Ä–∞—Ç–∫—É—é –≤–µ—Ä—Å–∏—é –≤ –∫–æ–Ω—Å–æ–ª—å
    print("\n" + "="*60)
    print("üèÜ –ì–õ–ê–í–ù–´–ô –í–´–í–û–î –ü–†–û–ï–ö–¢–ê:")
    print("="*60)
    print(f"–û—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –≤–æ–ø—Ä–æ—Å: '–í –∫–∞–∫–æ–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–∏—Å–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ?'")
    print(f"‚Üí –õ–£–ß–®–ò–ô –î–ï–ù–¨: {best_day} —Å–æ —Å—Ä–µ–¥–Ω–∏–º –±–∞–ª–ª–æ–º {best_day_score:.2f}")
    print(f"‚Üí –õ–£–ß–®–ï–ï –í–†–ï–ú–Ø: {best_lesson}-–π —É—Ä–æ–∫ ({best_lesson_score:.2f} –±–∞–ª–ª–∞)")
    print("="*60)
    
    return report

# =============================================================================
# 6. –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø
# =============================================================================

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞"""
    
    print("\n" + "="*70)
    print(" " * 10 + "üéì –®–ö–û–õ–¨–ù–´–ô –ü–†–û–ï–ö–¢: –ê–Ω–∞–ª–∏–∑ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ - –º–∏—Ñ—ã –∏ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å")
    print("="*70)
    
    try:
        # –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        df = load_and_clean_data()
        
        if df is None or len(df) == 0:
            print("\n‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞. –ü—Ä–æ–µ–∫—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω.")
            return
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
        day_avg, lesson_avg, attendance_data, subject_avg = create_static_plots(df)
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
        create_interactive_plots(df, day_avg, lesson_avg)
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞
        generate_report(df, day_avg, lesson_avg, attendance_data, subject_avg)
        
        print("\n" + "="*70)
        print("üéâ –ü–†–û–ï–ö–¢ –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù!")
        print("="*70)
        print("\nüìÅ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´:")
        print("  ‚Ä¢ presentation/—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞_—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏.png - –≤—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –≤ –æ–¥–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏")
        print("  ‚Ä¢ presentation/–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ_–≥—Ä–∞—Ñ–∏–∫–∏/ - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ HTML-–≥—Ä–∞—Ñ–∏–∫–∏")
        print("  ‚Ä¢ presentation/–æ—Ç—á—ë—Ç_–ø–æ_–ø—Ä–æ–µ–∫—Ç—É.txt - –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç")
        print("  ‚Ä¢ data/survey_data.csv - –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞")
        
        print("\nüöÄ –ß–¢–û –î–ê–õ–¨–®–ï:")
        print("  1. –ü–æ–∫–∞–∂–∏—Ç–µ –≥—Ä–∞—Ñ–∏–∫–∏ –Ω–∞ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏")
        print("  2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏")
        print("  3. –û–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –≤—ã–≤–æ–¥–∞–º–∏ –≤ –æ—Ç—á—ë—Ç–µ")
        print("  4. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤")
        
        print("\n" + "="*70)
        
    except Exception as e:
        print(f"\n‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: {e}")
        print("\nüîß –£–°–¢–†–ê–ù–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú:")
        print("  1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ Python")
        print("  2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: pip install pandas matplotlib seaborn numpy")
        print("  3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –ø–∞–ø–∫—É")
        print("  4. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Google Colab")

# =============================================================================
# 7. –ó–ê–ü–£–°–ö –ü–†–û–ï–ö–¢–ê
# =============================================================================

if __name__ == "__main__":
    # –°–æ–∑–¥–∞—ë–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–ø–∫–∏
    os.makedirs('data', exist_ok=True)
    os.makedirs('presentation', exist_ok=True)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–µ–∫—Ç
    main()